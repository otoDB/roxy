---
title: "音MADのタイトルとサムネイルを透過的に取得する: roxy.otodb.net について"
author: SnO2WMaN
date: 2025-12-06
lang: ja
---

# 音MADのタイトルとサムネイルを透過的に取得する: [roxy.otodb.net](https://roxy.otodb.net) について

> [!IMPORTANT]
> この記事は [音MAD Advent Calendar 2025](https://adventar.org/calendars/12426) の8日目の投稿として書かれたものです．執筆時の仕様などを書いたものなので，現状の実装とは乖離している可能性があります．正確な詳細は [README.md](../README.md) を参考にしてください．

## はじめに

こんにちは．SnO2WMaN ([Twitter][SnO2WMaN@Twitter], [GitHub][SnO2WMaN@GitHub]) と申します．

音MADを作っているわけではないのでこのアドベントカレンダーに参加するのは少し気が引けるのですが，普段は音MADのデータベースである [otoDB] の開発やモデレータなどをしたり，[音MADなどでDJをしたり](https://www.nicovideo.jp/user/118012640/series/515086)しています．

[otoDB]: https://otodb.net
[SnO2WMaN@Twitter]: https://x.com/SnO2WMaN
[SnO2WMaN@GitHub]: https://github.com/SnO2WMaN
[MADDRIFT2]: https://minamon.myportfolio.com/maddrift2

さて，そのような縁もあり，先日 [MADDRIFT2] というイベントで音MAD及びサンプリング音楽のDJをさせていただきました．
その際，イベントの出演者同士でセットリストが衝突しないようにGoogleスプレッドシートで管理することになり，owataxさんのnerdtronics2用のスプレッドシート[^owatax]を利用することになりました．

[^owatax]: [owatax, "nerdtronics2の振り返り③ (選曲管理/音MAD-mix監修) #ナートロ2"](https://owatax00.hatenablog.com/entry/2022/12/16/220025)

入力者側の手間を省くために，このスプレッドシートにはニコニコ動画のURLからタイトルをある自動で程度取得する機能があります．
ところが，例えば [MADDRIFT2の自分のパートのセットリスト](https://docs.google.com/spreadsheets/d/1uupTpF7A7RbZnftnLcoZ-ncAqOE-aSdcnBvL0duDrjc/edit?gid=1705056694#gid=1705056694) を見てほしいのですが，このスプレッドシートにはデバイス規制がかかっている動画に関してはタイトルが取得出来ないという問題があります．

![MADDRIFT2のスプレッドシート](./notes_20251205/maddrift2_spreadsheet.png)

さらに言えば，技術的な問題により，対応しているのはニコニコ動画のみであり，Youtubeの動画のタイトル取得には対応していないという問題があります．（画像の22行(No.18)を見なさい．）
欲を言えば，リンクのプレビューでサムネイルなどが表示されるとはいえ，スプレッドシート内で動画のサムネイルなども表示されてくれれば一覧性もあると思います．

---

この問題を解決するために，[otoDB] のデータを上手く活用したプロキシをデプロイしました．以下このプロキシを単に _roxy_ と呼ぶことにします．

- エンドポイント: https://roxy.otodb.net （クエリを与えなければ単に下のGitHubのリポジトリにリダイレクトされるだけです）
- GitHubリポジトリ: https://github.com/otoDB/roxy

利用例は例えば次の画像のようになります．このスプレッドシートは [ここ](https://docs.google.com/spreadsheets/d/1a_P3bdOOKh7cOy6jwhB2ObHD_DrIIWC-2QwdnLqbawc?usp=sharing) から閲覧することも出来ます．

![roxyを使ったスプレッドシート](./notes_20251205/roxy_spreadsheet.png)

roxyでは次のことが可能です．
- 動画タイトルに加えてサムネイルと，roxy内でユニークなID(後述)を返却します．
- ある程度URLのクエリの曖昧さを許すようにしています．（`sm2057168`と`https://www.nicovideo.jp/watch/sm2057168`のどちらで入力しても良い）
- ニコニコ動画以外にもYoutube，Bilibili，SoundCloudに対応．

この記事では，roxy の使い方と技術的詳細を説明します．

## 使い方

roxyはとりあえずのところGoogleスプレッドシートでの利用を想定しているため，XMLを返す機能があります．

XMLを出力するエンドポイント: https://roxy.otodb.net/xml

`q` パラメータでクエリを入力します．
例えば，執筆時現在，https://roxy.otodb.net/xml?q=sm42246476 の出力結果は以下の通りです．

```xml
<data>
	<query>
		<platform>Niconico</platform>
		<id>sm42246476</id>
	</query>
	<url>https://www.nicovideo.jp/watch/sm42246476</url>
	<title>ロキシイ / roxy</title>
	<thumbnail>
		https://cdn.otodb.net/t/8d/ac/8dac583463a8b571582b1e59596114d9aee5af9def466a4cf70cf8aba85dabf6.jpg
	</thumbnail>
	<otodb>
		<id>6912</id>
	</otodb>
	<identifier>otodb:6912</identifier>
</data>
```

ここからはGoogleスプレッドシート内で実際に利用する際の関数をメモしておきます．対応しているプラットフォームのURLまたは投稿のIDは`A2`セルに入っているものとします．
執筆時現在は次のプラットフォームに対応しています．
- ニコニコ動画: `sm44769600` や `https://www.nicovideo.jp/watch/sm44769600` など
- Youtube: `w6Tjn_M5rTc` や `https://www.youtube.com/watch?v=w6Tjn_M5rTc` など
- Bilibili: `BV19M4y1h7wM` や `https://www.bilibili.com/video/BV19M4y1h7wM` など
- SoundCloud: 音源のURLをそのまま貼ってください: `https://soundcloud.com/hxudmdc1lxrs/worldwidepunyapunya`

Googleプレッドシートは `IMPORTXML` 関数で 外部のXMLファイルを取得する機能があり，これを応用します．

次の関数で動画タイトルが取得できます．

```
=IF(A2<>"", IMPORTXML(CONCATENATE("https://roxy.otodb.net/xml?q=", A2),"/data/title"), "")
```

次の関数でサムネイルのURLが取得できます．

```
=IF(A2<>"", IMAGE(IMPORTXML(CONCATENATE("https://roxy.otodb.net/xml?q=", A2),"/data/thumbnail")), "")
```

次の関数でroxy内では一意なIDが取得できます．重複チェックなどに利用出来ます．

```
=IF(A2<>"", IMAGE(IMPORTXML(CONCATENATE("https://roxy.otodb.net/xml?q=", A2),"/data/identifier")), "")
```

roxy内では一意なIDであるとは次の意味です．

1. 動画が [otoDB] に登録されている場合，otoDBの作品IDとして返却され，`otodb:123` のようになります．この際，投稿されたプラットフォームが異なる場合や転載，再投稿について，otoDB内で同一な投稿として扱われている場合は同じIDが返却されることを注意しておきます．
2. 動画がotoDBに登録されていない場合，プラットフォームとその投稿のIDを`:`で繋いだものを返却します．`nicovideo:sm44769600` のようになります．

## 技術的詳細

### 課題

## おわりに

この記事では roxy の使い方と技術的詳細を概説しました．
ぜひ使ってみて，使用感を確かめてほしいです．
[課題](#課題)でも書いた通り，現状でも様々な問題があるとは思うので，要望は [Issue](https://github.com/otoDB/roxy/issues) に書くか，何らかの連絡手段で私に連絡していただければ，なるべく対応します．

## 謝辞

名前のヒントとしてたまたま流していた [ロキシイ / roxy](https://www.nicovideo.jp/watch/sm42246476) に感謝する．
どう考えてもキャラクター名そのままだと思うのだが，私はまだ無職転生を観ていない．

[![sm42246476](https://nicothumb2img.vercel.app/image/sm42246476#.png)](https://www.nicovideo.jp/watch/sm42246476)


